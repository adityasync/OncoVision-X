# OncoVision-X Training Configuration
# Optimized for Dual Quadro RTX 6000 (2x 25GB VRAM)

# Model Configuration
model:
  name: "OncoVisionX"
  nodule_patch_size: 64
  context_patch_size: 48
  backbone: "efficientnet_b0"       # B0 — proven stable, AUC 0.9555
  num_classes: 1
  nodule_feature_dim: 512           # Original proven dims
  context_feature_dim: 256          # Original proven dims
  fusion_dim: 256                   # Original proven dims
  num_attention_heads: 4            # Original proven config
  dropout: 0.5
  prediction_dropout: 0.3
  mc_dropout_passes: 10
  slice_neighbors: 2               # ±2 slices for cross-slice attention

# Training Configuration
training:
  batch_size: 48                    # Single GPU, plenty of headroom
  num_epochs: 150                   # Extended from 60 for more convergence

  # Learning rate
  learning_rate: 3.0e-4             # Original proven LR
  weight_decay: 1.0e-5
  warmup_epochs: 3                  # Gentle warmup

  # Progressive curriculum learning
  curriculum:
    stage1_epochs: 40
    stage2_epochs: 40
    stage3_epochs: 70

  # Optimization
  optimizer: "AdamW"
  scheduler: "CosineAnnealingWarmRestarts"
  scheduler_T0: 15
  scheduler_Tmult: 2

  use_amp: false                   # Disabled — float32 for stability
  gradient_clip: 1.0               # Proven stable value
  gradient_accumulation_steps: 1

  # Multi-GPU settings
  # DataParallel DISABLED: NoduleStream's 3D→2D slice processing
  # causes cuDNN stream errors with multi-GPU.
  use_data_parallel: false
  device_ids: [0]

  # Loss function weights
  loss_weights:
    bce: 0.4
    focal: 0.4
    uncertainty: 0.2
  focal_gamma: 2.0
  focal_alpha: 0.9375              # Adjusted for 1:15 ratio (15/16)
  label_smoothing: 0.1

  # Early stopping
  early_stopping_patience: 35

# Data Configuration
data:
  data_dir: "data"
  preprocessed_dir: "preprocessed_data"

  # DataLoader settings
  num_workers: 8
  pin_memory: true
  prefetch_factor: 4
  persistent_workers: true

  # Data balancing — 1:15 ratio for richer training
  positive_negative_ratio: 15

  # Augmentation
  augmentation:
    enabled: true
    rotation: true
    flip: true
    noise: true
    noise_std: 0.05
    intensity_shift: 0.1

  # Train/Val/Test split (subset-based)
  train_subsets: [0, 1, 2]
  val_subsets: [3]
  test_subsets: [4]

# Logging Configuration
logging:
  use_wandb: false
  wandb_project: "oncovision-x"
  wandb_entity: "your_username"

  use_tensorboard: true
  log_interval: 10
  save_interval: 5

  checkpoint_dir: "results/checkpoints"
  log_dir: "logs"

# Paths
paths:
  data_root: "data"
  output_root: "results"
  model_save_dir: "results/checkpoints"
  log_dir: "logs"
  figures_dir: "results/figures"
